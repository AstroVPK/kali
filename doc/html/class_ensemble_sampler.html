<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CARMA Analysis: EnsembleSampler Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CARMA Analysis
   </div>
   <div id="projectbrief">Code to fit stochastic time series to C-ARMA Model</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('class_ensemble_sampler.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_ensemble_sampler-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">EnsembleSampler Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="_m_c_m_c_8hpp_source.html">MCMC.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2c9b3046553b31fe5b39792404c8431d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ensemble_sampler.html#a2c9b3046553b31fe5b39792404c8431d">EnsembleSampler</a> (int ndims, int nwalkers, int nsteps, int nthreads, double a, double(*func)(double *x, void *funcArgs), void *funcArgs, unsigned int zSeed, unsigned int bernoulliSeed, unsigned int walkerSeed)</td></tr>
<tr class="separator:a2c9b3046553b31fe5b39792404c8431d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c74a117a85a6230bb48533e88a4cec4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ensemble_sampler.html#a3c74a117a85a6230bb48533e88a4cec4">~EnsembleSampler</a> ()</td></tr>
<tr class="separator:a3c74a117a85a6230bb48533e88a4cec4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7673dd0aeca4848f3c4b3591192b606a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ensemble_sampler.html#a7673dd0aeca4848f3c4b3591192b606a">runMCMC</a> (double *initPos)</td></tr>
<tr class="separator:a7673dd0aeca4848f3c4b3591192b606a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a653fe4e94639dd1f09883bb5701d9809"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ensemble_sampler.html#a653fe4e94639dd1f09883bb5701d9809">writeChain</a> (string filePath, int mode)</td></tr>
<tr class="separator:a653fe4e94639dd1f09883bb5701d9809"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_m_c_m_c_8hpp_source.html#l00009">9</a> of file <a class="el" href="_m_c_m_c_8hpp_source.html">MCMC.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a2c9b3046553b31fe5b39792404c8431d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EnsembleSampler::EnsembleSampler </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nwalkers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsteps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nthreads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double(*)(double *x, void *funcArgs)&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>funcArgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>zSeed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>bernoulliSeed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>walkerSeed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>First, we make sure we have an even number of walkers. If not, we (silently!) increase the number of walkers by 1. Later, we will add code to make sure we have atleast twice the number of walkers as we have dimensions.</p>
<p>We will store the MCMC result in Chain. Chain is laid out as follows - for each step, we store each dimension of each walker. Chain[dimNum + walkerNum*numDims + stepNum*numDims*numWalkers] contains the value of dimension dimNum of walker walkerNum at step stepNum. We calculate the size of the Chain required, sizeChain = numDims*numWalkers*numSteps, and then allocate space to hold Chain.</p>
<p>We need numZs = numWalkers*numSteps stretch factors, Z, to move numWalkers walkers over numSteps steps. After allocating the space required to hold Z, we use the vdRngBeta function from the Intel MKL VSL to populate Z. To use vdRngBeta, we create a VSL_BRNG_SFMT19937 basic random stream and then run vdRngBeta with p = 0.5, q = 1.0, a = 1/a, Beta = (a^2-1.0)/a.</p>
<p>If the preprocessor macro WRITE_ZS is set in <a class="el" href="_m_c_m_c_8cpp.html">MCMC.cpp</a>, we write the Zs out.</p>
<p>If the preprocessor macro WRITE_WALKERS is set in <a class="el" href="_m_c_m_c_8cpp.html">MCMC.cpp</a>, we write the WalkerChoices out.</p>
<p>We will have to pick 1 walker from the complimentary ensemble to move each walker from the current ensemble. We allocate an array, walkerChoice, to hold the indices of the random walkers picked from the complimentary ensemble. We also initialize a random stream that we shall later use to pick our walkers. We will have to make a decision about whether to move the current walker or not. We allocate moveYesNo to hold the result of the decision. We also initialize a random stream that we shall later use to make our choices.</p>
<p>We will store the log likelihoods in an array called LnLike. This way we do not have to re-compute the LnLike multiple times for the same point. LnLike[walkerNum + stepNum*numWalkers] holds the LnLike of walker walkerNum at step stepNum.</p>
<p>We will use numThreads number of pointers to access the old and new positions of the current walker(s) and the old position of the complimentary walker.</p>

<p>Definition at line <a class="el" href="_m_c_m_c_8cpp_source.html#l00032">32</a> of file <a class="el" href="_m_c_m_c_8cpp_source.html">MCMC.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a3c74a117a85a6230bb48533e88a4cec4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EnsembleSampler::~EnsembleSampler </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_m_c_m_c_8cpp_source.html#l00137">137</a> of file <a class="el" href="_m_c_m_c_8cpp_source.html">MCMC.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a7673dd0aeca4848f3c4b3591192b606a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EnsembleSampler::runMCMC </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>initPos</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>We begin by computing the LnLike values for our initial walker positions.</p>
<p>We first run a loop over all the steps. Recall that the 0th step is the starting step and we don't want to do anything for that step. As before, k keeps track of the current step.</p>
<p>To enable parallelization, we split our walkers into two subsets indexed by 0 and 1. We will move all the walkers in the current subset, currSubSet, based on randomly chosen walkers in the complimentary subset, compSubSet. We index the subsets using l.</p>
<p>We set currSubSet to point to the current subset and set compSubSet to point to the complimentary subset. If subSetNum = 0, we want 1*sizeHalfStep. If subSetNum = 1, we want 0*sizeHalfStep. Use ((l+1)%2).</p>
<p>Move over walkers in current sub-chain</p>
<p>First we get the old position of the current walker.</p>
<p>Pick walker from complimentary ensemble and get the old position of that walker.</p>
<p>Now we get the location of the new position of the current walker.</p>
<p>Calculate the (tentative) new location to walk to.</p>
<p>Now compute the logLike at the new location and fetch the LnLike at the old location.</p>
<p>Calculate likelihood of accepting proposal. If both log likelihoods are non-neg infinity, calculate it. If the new likelihood is</p>
<p>Actually do a coin toss to test the proposal.</p>
<p>Check the result of the coin toss. Based on the result, either move the walker, or leave it alone. Write out the LnLike to the correct location.</p>

<p>Definition at line <a class="el" href="_m_c_m_c_8cpp_source.html#l00168">168</a> of file <a class="el" href="_m_c_m_c_8cpp_source.html">MCMC.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_ensemble_sampler_a7673dd0aeca4848f3c4b3591192b606a_icgraph.png" border="0" usemap="#class_ensemble_sampler_a7673dd0aeca4848f3c4b3591192b606a_icgraph" alt=""/></div>
<map name="class_ensemble_sampler_a7673dd0aeca4848f3c4b3591192b606a_icgraph" id="class_ensemble_sampler_a7673dd0aeca4848f3c4b3591192b606a_icgraph">
<area shape="rect" id="node2" href="fit_a_r_m_a_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="251,5,301,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a653fe4e94639dd1f09883bb5701d9809"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EnsembleSampler::writeChain </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>filePath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_m_c_m_c_8cpp_source.html#l00470">470</a> of file <a class="el" href="_m_c_m_c_8cpp_source.html">MCMC.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_ensemble_sampler_a653fe4e94639dd1f09883bb5701d9809_icgraph.png" border="0" usemap="#class_ensemble_sampler_a653fe4e94639dd1f09883bb5701d9809_icgraph" alt=""/></div>
<map name="class_ensemble_sampler_a653fe4e94639dd1f09883bb5701d9809_icgraph" id="class_ensemble_sampler_a653fe4e94639dd1f09883bb5701d9809_icgraph">
<area shape="rect" id="node2" href="fit_a_r_m_a_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="253,5,304,32"/></map>
</div>
</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/vish/code/trunk/cpp/libcarma/include/<a class="el" href="_m_c_m_c_8hpp_source.html">MCMC.hpp</a></li>
<li>/home/vish/code/trunk/cpp/libcarma/src/<a class="el" href="_m_c_m_c_8cpp_source.html">MCMC.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="class_ensemble_sampler.html">EnsembleSampler</a></li>
    <li class="footer">Generated on Thu Oct 8 2015 14:25:25 for CARMA Analysis by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
